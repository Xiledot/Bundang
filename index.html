<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>영어 학습 도우미</title>
    <style>/* ... 기존 CSS 생략 ... */</style>
    <script src="https://cdn.jsdelivr.net/npm/leader-line-new@1.1.9/leader-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <h1>영어 학습 도우미</h1>
    <div id="navigation">
        <button id="show-structure-btn" class="active">구조 분석</button>
        <button id="show-question-btn">문제 생성</button>
        <button id="show-wordtest-btn">단어 테스트</button>
    </div>

    <div id="structure-analysis-section" class="feature-section active">
        <h2>문장 구조 분석</h2>
        <textarea id="inputSentence" rows="4" placeholder="분석할 영어 문장을 입력하세요..."></textarea><br>
        <button id="analyze-btn">분석하기</button>
        <div id="outputArea" class="output">분석 결과가 여기에 표시됩니다.</div>
    </div>

    <div id="question-generation-section" class="feature-section">
        <h2>문제 생성</h2>
        <textarea id="inputTextForQuestions" rows="10" placeholder="문제 생성을 위한 영어 지문을 입력하세요..."></textarea><br>
        <div id="quantity-selector">
            <button data-quantity="1" class="selected">1개</button>
            <button data-quantity="3">3개</button>
            <button data-quantity="5">5개</button>
        </div>
        <button id="generate-questions-btn">문제 생성하기</button>
        <div id="questionsOutputArea" class="output">생성된 문제가 여기에 표시됩니다.</div>
        <button id="export-pdf-btn">PDF로 저장</button>
        <button id="copy-html-btn">서식 복사</button>
    </div>

    <div id="wordtest-section" class="feature-section">
        <h2>단어 테스트</h2>
        <textarea id="wordInput" placeholder="단어:뜻 또는 단어 의미 형식으로 입력하세요"></textarea><br>
        <button id="load-words-btn">단어 로드</button>
        <div id="waiting-screen" style="display:none;">
            <p>단어가 로드되었습니다. 테스트를 시작하세요.</p>
            <button id="start-slideshow-btn">테스트 시작</button>
        </div>
        <div id="slide" class="blank"></div>
    </div>

    <script>
    // DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
        // 섹션 요소
        const sections = {
            structure: document.getElementById('structure-analysis-section'),
            question: document.getElementById('question-generation-section'),
            wordtest: document.getElementById('wordtest-section')
        };
        const buttons = {
            structure: document.getElementById('show-structure-btn'),
            question: document.getElementById('show-question-btn'),
            wordtest: document.getElementById('show-wordtest-btn')
        };
        function activate(name) {
            // 버튼 스타일
            Object.keys(buttons).forEach(k => buttons[k].classList.toggle('active', k === name));
            // 섹션 표시
            Object.keys(sections).forEach(k => sections[k].classList.toggle('active', k === name));
        }
        // 네비게이션
        buttons.structure.addEventListener('click', () => activate('structure'));
        buttons.question.addEventListener('click', () => activate('question'));
        buttons.wordtest.addEventListener('click', () => activate('wordtest'));

        // 구조 분석 기능
        const analyzeBtn = document.getElementById('analyze-btn');
        analyzeBtn.addEventListener('click', analyzeSentence);

        // 문제 생성 기능
        const quantitySelector = document.getElementById('quantity-selector');
        quantitySelector.addEventListener('click', e => {
            if (e.target.tagName==='BUTTON') {
                quantitySelector.querySelectorAll('button').forEach(b=>b.classList.remove('selected'));
                e.target.classList.add('selected');
            }
        });
        const generateBtn = document.getElementById('generate-questions-btn');
        generateBtn.addEventListener('click', generateQuestions);
        document.getElementById('export-pdf-btn').addEventListener('click', exportToPdf);
        document.getElementById('copy-html-btn').addEventListener('click', copyFormattedHtml);

        // 단어 테스트 기능
        const wordInput = document.getElementById('wordInput');
        const loadBtn = document.getElementById('load-words-btn');
        const startBtn = document.getElementById('start-slideshow-btn');
        const waiting = document.getElementById('waiting-screen');
        const slideEl = document.getElementById('slide');
        let wordList = [], currentMeaning = '';
        function parseInput() {
            const lines = wordInput.value.split('\n').map(l=>l.trim()).filter(l=>l);
            const list=[];
            lines.forEach(line=>{
                if(line.includes(':')){
                    const [w,m]=line.split(':',2).map(s=>s.trim()); if(w&&m) list.push({word:w,meaning:m});
                } else {
                    const t=line.split(/\s+/);
                    for(let i=0;i<t.length-1;i+=2) list.push({word:t[i],meaning:t[i+1]});
                }
            }); return list;
        }
        function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}}
        loadBtn.addEventListener('click',()=>{
            wordList=parseInput(); if(wordList.length<30) return alert('최소 30개의 단어를 입력하세요!'); shuffle(wordList);
            wordInput.style.display='none'; loadBtn.style.display='none'; waiting.style.display='block';
        });
        async function runSlideshow(){
            waiting.style.display='none'; slideEl.style.display='flex'; startBtn.disabled=true;
            for(const {word,meaning} of wordList.slice(0,30)){
                currentMeaning=meaning; slideEl.textContent=word; slideEl.className='word'; await new Promise(r=>setTimeout(r,3000));
                slideEl.textContent=''; slideEl.className='blank'; await new Promise(r=>setTimeout(r,3000));
            }
            slideEl.textContent='테스트 종료!'; slideEl.className='word'; startBtn.disabled=false;
        }
        slideEl.addEventListener('click',()=>{if(slideEl.classList.contains('word')&&currentMeaning) slideEl.textContent=currentMeaning;});
        startBtn.addEventListener('click',runSlideshow);
    });

    // 기존 전역 함수: analyzeSentence, generateQuestions, exportToPdf, copyFormattedHtml, toggleAnswer 등
    </script>
</body>
</html>
